# Endfield Gacha Analyzer - 项目总结

## 1. 项目简介
这是一个基于 **React + Vite + Tailwind CSS** 构建的单页应用（SPA），专为《明日方舟：终末地》（推测）设计的抽卡记录分析工具。它完全运行在浏览器端，利用 LocalStorage 进行数据持久化，无需后端服务器，具备高性能和隐私安全的特点。

## 2. 核心功能

### 2.1 多种卡池支持
系统支持三种不同规则的卡池，逻辑高度定制化：
*   **限定池 (Limited)**：
    *   **保底机制**：80抽软保底（6星），10抽保底（5星）。
    *   **硬保底 (Spark)**：前 **120抽** 内必出当期限定（一次性）。
    *   **赠送机制**：每 **240抽** 额外赠送一个限定角色（循环）。
*   **武器池 (Weapon)**：
    *   **保底机制**：**40抽** 软保底（6星），10抽保底（5星）。
    *   **硬保底**：前 **80抽** 内必出当期限定武器（一次性）。
    *   **赠送机制**：复杂的交替赠送逻辑（100抽送常驻 -> 180抽送限定 -> 此后每80抽交替赠送常驻/限定）。
*   **常驻池 (Standard)**：
    *   **赠送机制**：首次 **300抽** 赠送一个自选常驻6星（一次性）。
    *   **显示优化**：不显示“限定/歪”的概念，只统计常驻6星。

### 2.2 数据录入与管理
*   **高效录入**：
    *   **十连编辑器**：提供丝滑的点击交互，支持快速切换 4/5/6 星及限定/常驻状态。独立的渲染优化，狂点不卡顿。
    *   **快捷单抽**：一键补录单次抽卡。
    *   **自动标记**：录入时自动检测是否触发 120/80 抽硬保底，并自动打上“保底”标记。
*   **历史记录管理**：
    *   **分组展示**：自动将同一时间的抽卡记录聚合展示（十连/单抽），按时间倒序排列，组内正序显示。
    *   **编辑/删除**：支持点击图标修改稀有度、类型（UP/歪）、特殊标记（保底/赠送）。支持整组删除。
    *   **安全保护**：所有删除操作均有二次确认弹窗。

### 2.3 数据统计与可视化
*   **智能看板**：
    *   **StatBox**：展示各稀有度数量、占比、不歪率（排除赠送）。限定6星图标带有**彩色流光特效**。
    *   **PityCard**：动态进度条展示距离 6星/5星 保底的抽数，以及特殊硬保底/赠送的达成进度（支持“已达成”状态和具体达成抽数显示）。
    *   **图表**：使用 Recharts 绘制饼图（分布概览）和柱状图（出货垫刀分布）。
*   **算法修正**：
    *   **不歪率**：严格基于“实际抽取出货”计算，排除所有手动标记为“赠送”或系统机制赠送的角色。
    *   **平均花费**：计算平均出货抽数时，分母自动剔除赠送角色。

### 2.4 数据备份
*   **导出**：
    *   **JSON**：完整备份所有卡池数据，或仅导出当前卡池。
    *   **CSV**：导出 Excel 可读的表格文件，支持全部或当前卡池。
*   **导入**：支持恢复 JSON 备份数据（自动去重）。

## 3. 技术架构与性能优化

### 3.1 技术栈
*   **框架**：React 18
*   **构建工具**：Vite
*   **样式**：Tailwind CSS v4 (配置了 `@tailwindcss/postcss`)
*   **图标库**：Lucide React
*   **图表库**：Recharts

### 3.2 性能优化策略
针对 1700+ 条甚至更多数据的场景进行了深度优化：
1.  **LocalStorage 防抖 (Debounce)**：写入操作延迟 1 秒执行，避免高频操作阻塞主线程。
2.  **组件级缓存 (React.memo)**：
    *   `InputSection`：独立封装，确保录入时的频繁状态变更不会触发父组件重绘。
    *   `BatchCard` & `EditItemModal`：列表项和弹窗均已缓存。
3.  **列表虚拟化/分页**：
    *   历史记录列表默认只渲染最近 **20 组** 数据。
    *   提供“加载更多”按钮，按需渲染，彻底解决长列表卡顿。
4.  **计算优化**：
    *   移除高频调用的 `sort` 操作，利用数据追加特性改用 `reverse`。
    *   核心统计逻辑全部包裹在 `useMemo` 中。

## 4. 文件结构
*   `src/GachaAnalyzer.jsx`: 核心业务组件，包含所有逻辑。
*   `src/App.jsx`: 入口组件，挂载 GachaAnalyzer。
*   `tailwind.config.js` / `postcss.config.js`: 样式配置。

## 5. 后续维护
目前架构基于纯前端，足以支撑数万条数据的流畅操作。如未来需扩展多端同步或社交功能，建议迁移至 Supabase + Vercel 架构。
